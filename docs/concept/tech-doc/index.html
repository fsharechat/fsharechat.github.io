<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="fsharechat">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@questdb">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="shortcut icon" href="https://https://fsharechat.github.io//img/favicon.png">
<link rel="apple-touch-icon" sizes="48x48" href="/img/icons/icon-48x48.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/icons/icon-72x72.png">
<link rel="apple-touch-icon" sizes="96x96" href="/img/icons/icon-96x96.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/icons/icon-144x144.png">
<link rel="apple-touch-icon" sizes="192x192" href="/img/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="256x256" href="/img/icons/icon-256x256.png">
<link rel="apple-touch-icon" sizes="384x384" href="/img/icons/icon-384x384.png">
<link rel="apple-touch-icon" sizes="512x512" href="/img/icons/icon-512x512.png">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="飞享IM-即时IM通讯系统  Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="飞享IM-即时IM通讯系统  Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H6YPVFKWXP"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-H6YPVFKWXP",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="飞享IM-即时IM通讯系统 " href="/opensearch.xml">
<link rel="icon" href="/img/favicon.png">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c">
<link rel="apple-touch-icon" href="/img/favicon.png">
<link rel="mask-icon" href="/img/favicon.png" content="#fff">
<meta name="msapplication-TileImage" content="/img/favicon.png">
<meta name="msapplication-TileColor" content="#21222c"><title data-react-helmet="true">即时聊天系统技术文档 | 飞享IM-即时IM通讯系统 </title><meta data-react-helmet="true" property="og:image" content="https://https://fsharechat.github.io//img/og.png"><meta data-react-helmet="true" name="twitter:image" content="https://https://fsharechat.github.io//img/og.png"><meta data-react-helmet="true" name="twitter:description" content="飞享IM 做技术自主可控的即时通讯IM"><meta data-react-helmet="true" name="twitter:title" content="Introduction | 飞享IM-即时IM通讯系统 "><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | 飞享IM-即时IM通讯系统 &quot;"><meta data-react-helmet="true" property="og:title" content="即时聊天系统技术文档 | 飞享IM-即时IM通讯系统 "><meta data-react-helmet="true" name="description" content="IM TECH"><meta data-react-helmet="true" property="og:description" content="IM TECH"><meta data-react-helmet="true" property="og:url" content="https://https://fsharechat.github.io//docs/concept/tech-doc"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://https://fsharechat.github.io//docs/concept/tech-doc"><link rel="stylesheet" href="/styles.6808db04.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="飞享IM 做技术自主可控的即时通讯IM">
<meta itemprop="description" content="飞享IM 做技术自主可控的即时通讯IM">
<meta itemprop="url" content="https://https://fsharechat.github.io/">
<meta itemprop="logo" content="https://https://fsharechat.github.io//img/favicon.png">
<meta itemprop="sameAs" content="https://weibo.com/comsince">
<meta itemprop="sameAs" content="https://www.linkedin.com/company/comsince/">
<meta itemprop="sameAs" content="https://www.crunchbase.com/organization/quest-db">
<meta itemprop="sameAs" content="https://github.com/fsharechat">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner inner_3txf"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand brand_9Wyn" href="/"><img alt="fsharechat" class="navbar__logo" src="/img/navbar/fshare.svg"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">安装</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/guide/centos/">Centos</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/ubuntu/">Ubuntu</a></li><li><a class="dropdown__link" position="left" href="/docs/guide/windows/">Windows</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/">文档</a><a class="navbar__item navbar__link" href="/blog/">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/fsharechat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__item--github">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button><a class="getStarted_1xnS button_Ni2_ button--primary_316O button--uppercase_35Ce button--xsmall_3jz_" href="/getstarted/">客户端下载</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_9Wyn" href="/"><img alt="fsharechat" class="navbar__logo" src="/img/navbar/fshare.svg"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">安装</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/centos/">Centos</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/ubuntu/">Ubuntu</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/guide/windows/">Windows</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/introduction/">文档</a></li><li class="menu__list-item"><a class="menu__link" href="/blog/">博客</a></li><li class="menu__list-item"><a href="https://github.com/fsharechat" target="_blank" rel="noopener noreferrer" class="menu__link navbar__item--github">GitHub</a></li></ul></div></div></div></nav><div class="wrapper_1hNx"><div class="doc_2sKW"><div class="docs-sidebar doc__sidebar_1koD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">概述</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">系统架构</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/concept/tech-doc">即时聊天系统技术文档</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concept/web-rtc-intro">实时音视频开发的工程化实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concept/muti-conference-rtc">多人音视频会话方案预研</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concept/delivery-read-report">送达与已读回执的设计方案说明</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">安装准备</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/prepare/mysql">MySQL基本安装</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/prepare/minio">Minio基本安装说明</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/prepare/cert">证书配置说明</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/prepare/nginx">Nginx安装配置说明</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/prepare/coturn">Coturn服务安装</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">安装指南</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/centos">Centos上单机部署实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/ubuntu">Ubuntu上单机部署实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/windows">Windows单机部署实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/cluster">飞享IM集群架构与安装说明</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">开放接口</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/pushapi">发送系统通知</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">服务咨询</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/consult/contact">商业合作咨询事项说明</a></li></ul></li></ul></div></div></div><main class="doc__main_23K2"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">即时聊天系统技术文档</h1></header><div class="markdown"><p>本文档主要说明飞享即时聊天系统的技术相关文档,用于支持其他多端开发.说明系统的整体架构与后续技术<code>发展规划</code>,<code>技术愿景</code>,<code>未来商业化支持</code></p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</h5></div><div class="admonition-content"><p>本文未经授权禁止转载</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="概述"></a>概述<a aria-hidden="true" tabindex="-1" class="hash-link" href="#概述" title="Direct link to heading">#</a></h2><p>飞享是一个即时聊天系统整体解决方案,更像一个开箱即用的即时通讯产品化解决方案.在设计之初,尽量遵照平台原生开发的要求进行,因为我们始终觉得原生的体验是达到一个优秀即时通讯的基本要求.在对客户端,服务端设计的过程中,尽量采用业界通用的方案进行.不用过于依赖某项技术,因为我们任何只有合适的技术用在合适的系统上才能发挥它固有的价值.</p><p>初衷开始这个项目只是对即时通讯的喜爱,慢慢不断的发展成为一个即时通讯类产品,在功能的不断迭代中,需要我们停下脚本思考一些问题.更希望这个一个技术解决方案,而不是基于某种语言或者框架的解决方案.也是服务端通信框架是基于<code>t-io</code>(基于AIO的网络编程框架,提供便捷的API,方便管理,快速使用),或者是基于<code>Netty</code>(基于NIO的异步网络编程框架).也是服务端编程语言是基于<code>Java</code>或者是基于<code>Go</code>.技术本身是为了解决实际问题,不应该是限制具体某个领域的发展.在编写客户端应用时,可以支持<code>Android</code>,也可以支持<code>iOS</code>,可以支持<code>Web</code>.支持我们遵循我们设计的交互协议规范,这些都可以迎刃而解,不管你是采用Android或者iOS原生开发,还是跨平台开发,使用Js框架Vue,React.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="系统架构"></a>系统架构<a aria-hidden="true" tabindex="-1" class="hash-link" href="#系统架构" title="Direct link to heading">#</a></h2><p>系统架构在以后更多的是解决用户不断增多进而导致的,硬件支持,软件支持.更多的用户带来的挑战包括不断增长的数据,需要不断优化的用户体验.功能的迭代带来系统复杂度不断增大,给软件架构带来更多的挑战.所以基于我们现在的简单分布式架构,解决小部分用户使用尚可,后续需要考虑更多的用户,更优的用户体验,因此需要不断的优化软件架构</p><p><strong>NOTE:</strong> 如下为简要的系统部署图</p><p><img src="https://media.comsince.cn/minio-bucket-image-name/1-373z3zNN-1605774295102-IM_Atitect.png" alt="image"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="系统流程图"></a>系统流程图<a aria-hidden="true" tabindex="-1" class="hash-link" href="#系统流程图" title="Direct link to heading">#</a></h2><p><img src="https://media.comsince.cn/minio-bucket-image-name/push-universe-flow.png" alt="image"></p><p>重点关注核心要点:<code>登录实现</code>,<code>消息不丢失设计</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="登录设计"></a>登录设计<a aria-hidden="true" tabindex="-1" class="hash-link" href="#登录设计" title="Direct link to heading">#</a></h3><p>系统登录是进行用户管理的关键,现行设计采用<code>手机号</code>+<code>验证码</code>的方式进行,登录的目地是生成会话,以支持同一帐号不同设备登录的功能</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="用户token生成"></a>用户token生成<a aria-hidden="true" tabindex="-1" class="hash-link" href="#用户token生成" title="Direct link to heading">#</a></h4><p><strong>NOTE:</strong> 每一个用户Id登录不同设备,采用不同的cid,即是采用uid(用户id)+cid(设备唯一id)生成session,token中间分隔符为<code>|</code></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="token规则"></a>token规则<a aria-hidden="true" tabindex="-1" class="hash-link" href="#token规则" title="Direct link to heading">#</a></h5><p>usertoken | session secret | db secret</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="usertoken规则"></a>usertoken规则<a aria-hidden="true" tabindex="-1" class="hash-link" href="#usertoken规则" title="Direct link to heading">#</a></h5><p>testim | 时间戳 | 用户名</p><ul><li>核心代码</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">static</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">getToken</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">String</span><span class="token plain"> username</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> signKey </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> KEY </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;|&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">System</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">currentTimeMillis</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;|&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> username</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> DES</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">encryptDES</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">signKey</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#6272a4">// TODO Auto-generated catch block</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            e</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">printStackTrace</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">null</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><ul><li>返回的token是经过AES加密然后Base64编码</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="客户端接入方式"></a>客户端接入方式<a aria-hidden="true" tabindex="-1" class="hash-link" href="#客户端接入方式" title="Direct link to heading">#</a></h4><p><strong>NOTE:</strong> 用户登录成功后,会成功获取到上面生成的token,例如web端在获取到这个<code>token</code>保存在浏览器的<code>localstorage</code>里面.这个toekn将作为后续发送验证请求的关键.登录成功后要发送<code>connect</code>信令进行链接验证,关于信令的传输将会在下面介绍</p><p><img src="https://media.comsince.cn/minio-bucket-image-name/login.png" alt="image"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="解密分离token"></a>解密分离token<a aria-hidden="true" tabindex="-1" class="hash-link" href="#解密分离token" title="Direct link to heading">#</a></h4><p>上面已经知道token是三部分加密组成,因此这里需要解密token,得到如下三部分内容</p><ul><li>usertoken</li><li>session secret</li><li>db secret</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="生成密码"></a>生成密码<a aria-hidden="true" tabindex="-1" class="hash-link" href="#生成密码" title="Direct link to heading">#</a></h4><p><strong>NOTE:</strong> 以下是发送<code>connect</code>信令携带的消息体</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    userName</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token maybe-class-name">LocalStore</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">getUserId</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">//用户id</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    password</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> pwdAesBase64</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">//生成的用户密码</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    clientIdentifier</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token dom variable" style="color:#ff79c6">localStorage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#8be9fd">getItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token constant" style="color:#bd93f9">KEY_VUE_DEVICE_ID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">//当前用户登录设备唯一id</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="生成规则"></a>生成规则<a aria-hidden="true" tabindex="-1" class="hash-link" href="#生成规则" title="Direct link to heading">#</a></h4><p>password 为 usertoken使用session secret经过AES加密得出的.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="服务端认证"></a>服务端认证<a aria-hidden="true" tabindex="-1" class="hash-link" href="#服务端认证" title="Direct link to heading">#</a></h4><p>客户端在传入上述的<code>connect</code>消息后,需要经过消息认证才算接入成功,每次用户会话都有一个session,利用session secret
对<code>password</code>字段进行AES解密,如果能够解密成功,则表示登录验证成功</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="系统接口文档"></a>系统接口文档<a aria-hidden="true" tabindex="-1" class="hash-link" href="#系统接口文档" title="Direct link to heading">#</a></h2><p>系统的接入方式多种多样,带来的挑战是需要支持多种接入方式.对于Android,ios需要基于TCP实现用户长链接,保证消息即时可达.因此需要设计私有协议,
对于web端,可以采用websocket协议,只需要在消息体中设计我们的消息格式即可.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="私有二进制协议"></a>私有二进制协议<a aria-hidden="true" tabindex="-1" class="hash-link" href="#私有二进制协议" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-questdb-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">+---------------+---------------+---------------+---------------+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">|      magic(8) |   version(8)  |   signal(8)   |               |</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">+---------------+---------------+---------------+---------------+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">|                          length(32)                           | </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">+---------------+---------------+---------------+---------------+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">|   subsignal(8)|       messageId(16)           |  paload data  :</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">+---------------+---------------+---------------+---------------+</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">:             payload data(length)                              :</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">+---------------+---------------+---------------+---------------+</span></div></div></div></div></div><p><strong>NOTE:</strong> 参数说明如下</p><ul><li><strong>magic</strong> 魔数,用于标记消息的起始位置</li><li><strong>version</strong>  协议版本号</li><li><strong>signal</strong>   主消息信令</li><li><strong>length</strong>   消息体长度</li><li><strong>subsignal</strong> 消息子信令</li><li><strong>messageId</strong> 消息ID，用于标记当前消息，可用作消息确认</li><li><strong>payload data</strong> 消息体,长度由<code>length</code>定义</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="信令定义说明"></a>信令定义说明<a aria-hidden="true" tabindex="-1" class="hash-link" href="#信令定义说明" title="Direct link to heading">#</a></h4><p><strong>NOTE:</strong> 如下是主信令与子信令对应关系</p><table><tr><th>主信令</th><th>子信令</th><th>信令说明</th></tr><tr><td>PING</td><td>无</td><td>心跳主信令</td></tr><tr><td>PUSH</td><td>无</td><td>推送消息主信令</td></tr><tr><td rowspan="8">CONNECT</td><td>CONNECTION_ACCEPTED</td><td>接受链接</td></tr><tr><td>CONNECTION_REFUSED_UNACCEPTABLE_PROTOCOL_VERSION</td><td>不可接受的协议</td></tr><tr><td>CONNECTION_REFUSED_IDENTIFIER_REJECTED</td><td>用户拒绝</td></tr><tr><td>CONNECTION_REFUSED_SERVER_UNAVAILABLE</td><td>服务不可用</td></tr><tr><td>CONNECTION_REFUSED_BAD_USER_NAME_OR_PASSWORD</td><td>用户名或密码错误</td></tr><tr><td>CONNECTION_REFUSED_NOT_AUTHORIZED</td><td>没有授权</td></tr><tr><td>CONNECTION_REFUSED_UNEXPECT_NODE</td><td>节点拒绝链接</td></tr><tr><td>CONNECTION_REFUSED_SESSION_NOT_EXIST</td><td>会话不存在</td></tr><tr><td>DISCONNECT</td><td>无</td><td>心跳主信令</td></tr><tr><td>CONNECT_ACK</td><td>无</td><td>心跳主信令</td></tr><tr><td rowspan="23">PUBLISH</td><td>US</td><td>用户搜索</td></tr><tr><td>FAR</td><td>朋友添加请求</td></tr><tr><td>UPUI</td><td>用户信息</td></tr><tr><td>FRN</td><td>朋友添加通知</td></tr><tr><td>FRP</td><td>拉取朋友请求</td></tr><tr><td>FHR</td><td>处理朋友申请</td></tr><tr><td>FP</td><td>获取朋友列表</td></tr><tr><td>MN</td><td>消息通知</td></tr><tr><td>MS</td><td>发送消息</td></tr><tr><td>MP</td><td>获取消息</td></tr><tr><td>FN</td><td>朋友添加通知</td></tr><tr><td>GC</td><td>创建群组</td></tr><tr><td>GPGI</td><td>获取群组信息</td></tr><tr><td>GPGM</td><td>获取群组成员</td></tr><tr><td>GAM</td><td>添加群组成员</td></tr><tr><td>GKM</td><td>移除群组成员</td></tr><tr><td>GQ</td><td>退出群组</td></tr><tr><td>GMI</td><td>修改群组信息</td></tr><tr><td>MMI</td><td>修改个人信息</td></tr><tr><td>GQNUT</td><td>获取上传文件token</td></tr><tr><td>MR</td><td>消息撤回</td></tr><tr><td>RMN</td><td>远程消息通知</td></tr><tr><td>LRM</td><td>拉取历史消息</td></tr><tr><td>PUB_ACK</td><td>确认主信令</td><td>子信令同上面Publish的子信令，这里不再一一列出</td></tr></table><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="信令交互路程"></a>信令交互路程<a aria-hidden="true" tabindex="-1" class="hash-link" href="#信令交互路程" title="Direct link to heading">#</a></h4><p>信令交互流程主要是指如何使用以上的信令进行业务处理，信令的设计都采用的发送确认机制，例如客户端发送<code>connect</code>信令后，正常情况下都会受到服务器返回的ack确认指令，这里就是<code>connect_ack</code>.
下面主要针对<code>PUBLISH</code>信令说明，因为这个主信令下面有比较多的子信令，每个信令的具体含义已经在上面做了相应的说明。下面主要来说明具体业务是如何交互的。下面以发送消息说明</p><ul><li>客户端构造信令消息体，此时<strong>signal</strong>为<strong>PUSHLISH</strong>，子信令为<strong>MS</strong>，代表用户需要发送消息</li><li>服务端接收到消息后解析指令，根据子信令处理相应的业务逻辑。处理成功后，服务端构造<strong>PUSH__ACK</strong>确认消息，此时主信令就是<code>PUSH_ACK</code>，子信令依旧保持不变为<code>MS</code></li><li>客户端收到确认指令后，根据返回的子消息信令进行后续的业务处理</li><li>由于信令支持messageId,用户可以根据messageId,确认是否是之前的消息，可以用其实现异步消息转为同步处理</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="基于websocket的消息体信令设计"></a>基于websocket的消息体信令设计<a aria-hidden="true" tabindex="-1" class="hash-link" href="#基于websocket的消息体信令设计" title="Direct link to heading">#</a></h3><p>由于web端采用的是websocket协议，所有我们只需要定义传输消息体格式既可，如下为websocket消息通讯的Json格式定义</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;signal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;connect&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">//主信令</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;sub_signal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;conect_ack&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">//子信令</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;message_id&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">  </span><span class="token comment" style="color:#6272a4">//消息id</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token plain">     </span><span class="token comment" style="color:#6272a4">//消息体</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><p><strong>NOTE：</strong> 这里的Json格式定义有点类似二进制通讯协议，只不过由于websocket协议本身定义了消息头，消息长度，因为不需要我们自己处理，因此我们只需要关注以上字段既可</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="基于消息信令的交互方式"></a>基于消息信令的交互方式<a aria-hidden="true" tabindex="-1" class="hash-link" href="#基于消息信令的交互方式" title="Direct link to heading">#</a></h3><p>业务交互主要是基于<code>PUBLISH</code>与<code>PUB_ACK</code>模式进行的,使用子信令进行业务类型区分,例如发送请求用户信息,websocket协议Json格式为</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;signal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;PUBLISH&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">//主信令</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;sub_signal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;UPUI&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">//子信令</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;message_id&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">  </span><span class="token comment" style="color:#6272a4">//消息id</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#f1fa8c">&quot;userids&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">     </span><span class="token comment" style="color:#6272a4">//用户id列表</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><p>了解完业务消息设计定义,你可以参考<code>unverse_push</code>项目的中<code>push-connector</code>中<code>com.comsince.github.websocket.model</code>包中定义的数据格式进行分析,了解不同业务信令下的数据格式定义</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="发送消息体结构"></a>发送消息体结构<a aria-hidden="true" tabindex="-1" class="hash-link" href="#发送消息体结构" title="Direct link to heading">#</a></h3><p>这里把发送消息体的定义单独列出来说明,是因为<code>MS</code>子信令的消息体结构设计跟上面的基本业务数据结构有很大的不同,有必要单独拿出来说明.这个这个消息体定义了发送聊天消息的各种类型,其也是以后作为扩展消息所必须要知道的数据结构</p><p><strong>NOTE:</strong> 以下是发送一个文本消息完整消息体</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;signal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;PUBLISH&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;subSignal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;MS&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;messageId&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">81</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;from&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;4A4A4Aaa&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;searchableContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;1234&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;pushContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;binaryContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;localContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;mediaType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;remoteMediaUrl&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;localMediaPath&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;mentionedType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;mentionedTargets&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;messageId&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1589944408832</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;direction&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;messageUid&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;timestamp&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1589944408832</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;to&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;conversationType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;target&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;d9dRdRoo&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;line&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><p>主信令与子信令含义不再描述,这里重点说明<code>content</code>消息定义,</p><p><strong>下图为消息定义参数对照表</strong></p><table><tr><th>字段名称</th><th>子字段</th><th>字段描述</th></tr><tr><td>from</td><td>无</td><td>来源</td></tr><tr><td>messageId</td><td>无</td><td>消息id,发送时随机生成</td></tr><tr><td>direction</td><td>无</td><td>消息方向,接收还是发送</td></tr><tr><td>status</td><td>无</td><td>推送转台</td></tr><tr><td>messageUid</td><td>无</td><td>消息唯一Id,由服务端返回</td></tr><tr><td>timestamp</td><td>无</td><td>消息时间戳</td></tr><tr><td>to</td><td>无</td><td>目标</td></tr><tr><td>conversationType</td><td>无</td><td>会话类型,单聊/群组</td></tr><tr><td>target</td><td>无</td><td>目标接收者Id</td></tr><tr><td>line</td><td>无</td><td>线路</td></tr><tr><td rowspan="11">content</td><td>type</td><td>消息内容类型</td></tr><tr><td>searchableContent</td><td>可供搜索的文本内容</td></tr><tr><td>pushContent</td><td>推送内容</td></tr><tr><td>content</td><td>内容</td></tr><tr><td>binaryContent</td><td>二进制消息内容,经过编码</td></tr><tr><td>localContent</td><td>消息本地内容</td></tr><tr><td>mediaType</td><td>媒体类型</td></tr><tr><td>remoteMediaUrl</td><td>媒体远程url,例如图片,视频,文件url</td></tr><tr><td>localMediaPath</td><td>本地媒体文件路径</td></tr><tr><td>mentionedType</td><td>提及类型</td></tr><tr><td>mentionedTargets</td><td>提及的对象ID</td></tr></table><p><strong>NOTE:</strong> 消息最终发送时,都会转化为Json格式,下面给出几个消息类型的示例</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="纯文本消息"></a>纯文本消息<a aria-hidden="true" tabindex="-1" class="hash-link" href="#纯文本消息" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;signal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;PUBLISH&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;subSignal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;MS&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;messageId&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">82</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;from&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;4A4A4Aaa&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;mentionedType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;mentionedTargets&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;searchableContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;纯文本消息&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;messageId&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1589955328518</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;direction&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;messageUid&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;timestamp&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1589955328518</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;to&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;conversationType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;target&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;d9dRdRoo&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;line&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="图片类型消息"></a>图片类型消息<a aria-hidden="true" tabindex="-1" class="hash-link" href="#图片类型消息" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;signal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;PUBLISH&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;subSignal&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;MS&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;messageId&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">84</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;from&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;4A4A4Aaa&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;mentionedType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;mentionedTargets&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;searchableContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;[图片]&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;binaryContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token null keyword" style="color:#ff79c6">null</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;mediaType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;remoteMediaUrl&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;http://image.comsince.cn/1-4A4A4Aaa-1589955429816-push-universe.png&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token property">&quot;localMediaPath&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;messageId&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1589955430361</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;direction&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;messageUid&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;timestamp&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1589955430361</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;to&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;conversationType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;target&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;d9dRdRoo&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;line&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><p><strong>NOTE:</strong> 与文本消息的区别在图片类消息携带的是图片的<code>remoteMediaUrl</code>,<code>type</code>类型为3,注意对于一些内容为空的字段进行省略</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="通知类消息"></a>通知类消息<a aria-hidden="true" tabindex="-1" class="hash-link" href="#通知类消息" title="Direct link to heading">#</a></h4><p>通知类消息,例如<code>加群通知</code>,<code>退群通知</code>,<code>撤回消息</code></p><ul><li>移除群组成员的通知类消息</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;binaryContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;eyJnIjoiYm9iQ2JDUFAiLCJvIjoiVllWTFZMMjIiLCJtcyI6WyJkemRKZEpfXyJdfQ==&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;content&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;mediaType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;mentionedType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;pushContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;remoteMediaUrl&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;searchableContent&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property">&quot;type&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">106</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;conversationType&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;direction&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;from&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;VYVLVL22&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;line&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;messageId&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">157747907456403130</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;messageUid&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;target&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;bobCbCPP&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property">&quot;timestamp&quot;</span><span class="token operator" style="color:#ff79c6">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1589956063904</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="消息类型扩展说明"></a>消息类型扩展说明<a aria-hidden="true" tabindex="-1" class="hash-link" href="#消息类型扩展说明" title="Direct link to heading">#</a></h4><p>为了以后能够支持更多的消息类型,支持更多的展示方式,本质还是定义出更多type类型的消息,例如可以添加相应的<code>商品链接消息</code>,展示<code>用户文章类分享</code>,这些都可以通过以上的数据结构扩展</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="音视频通讯"></a>音视频通讯<a aria-hidden="true" tabindex="-1" class="hash-link" href="#音视频通讯" title="Direct link to heading">#</a></h2><p><strong>NOTE:</strong> 目前只支持一对一音视频通话
音视频通话详见: <a href="/docs/concept/web-rtc-intro">实时音视频开发的工程化实践</a></p><p><strong>NOTE:</strong> 进行音视频前,请先检查浏览器的支持情况,可以打开此链接<a href="https://www.qcloudtrtc.com/webrtc-samples/abilitytest/index.html" target="_blank" rel="noopener noreferrer">检测</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="系统规划"></a>系统规划<a aria-hidden="true" tabindex="-1" class="hash-link" href="#系统规划" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="系统架构设计"></a>系统架构设计<a aria-hidden="true" tabindex="-1" class="hash-link" href="#系统架构设计" title="Direct link to heading">#</a></h3><p>系统会随着主流软件设计逐步进行架构设计,主要对系统的主要性能瓶颈进行一定的重新设计,例如接入用户数如何水平扩展,如果保证用户消息的大规模存储.
并尽量保证最具竞争力的设计,实现在即时通讯领域应用最新的技术架构,实现业务的稳步提升</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="多端开发系统体验"></a>多端开发系统体验<a aria-hidden="true" tabindex="-1" class="hash-link" href="#多端开发系统体验" title="Direct link to heading">#</a></h3><p>在用户体验上,尽量使用原生开发,当然在这些基础上,可以使用小程序开发,方便大家快速体验系统功能.系统体验上,尽量追求,普通大众最能接收的设计.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="可扩展性"></a>可扩展性<a aria-hidden="true" tabindex="-1" class="hash-link" href="#可扩展性" title="Direct link to heading">#</a></h3><p>相信很多用户可能对系统在实际应用中的效果并不满意,因此考虑系统的可扩展性,二次开发的便利性,需要提升</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="接入方便"></a>接入方便<a aria-hidden="true" tabindex="-1" class="hash-link" href="#接入方便" title="Direct link to heading">#</a></h3><p>服务端接入包括两种,基于TCP的二进制协议,web端基于websocket,为了简化接入人员的接入工作量,可以提供包括<code>Android</code>,<code>IOS</code>,<code>Web</code>的端的SDK,提供基础用于socket编程的基础sdk,包含信令消息发送与接收的sdk</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 概述</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/concept/web-rtc-intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">实时音视频开发的工程化实践 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link">概述</a></li><li><a href="#系统架构" class="table-of-contents__link">系统架构</a></li><li><a href="#系统流程图" class="table-of-contents__link">系统流程图</a><ul><li><a href="#登录设计" class="table-of-contents__link">登录设计</a></li></ul></li><li><a href="#系统接口文档" class="table-of-contents__link">系统接口文档</a><ul><li><a href="#私有二进制协议" class="table-of-contents__link">私有二进制协议</a></li><li><a href="#基于websocket的消息体信令设计" class="table-of-contents__link">基于websocket的消息体信令设计</a></li><li><a href="#基于消息信令的交互方式" class="table-of-contents__link">基于消息信令的交互方式</a></li><li><a href="#发送消息体结构" class="table-of-contents__link">发送消息体结构</a></li></ul></li><li><a href="#音视频通讯" class="table-of-contents__link">音视频通讯</a></li><li><a href="#系统规划" class="table-of-contents__link">系统规划</a><ul><li><a href="#系统架构设计" class="table-of-contents__link">系统架构设计</a></li><li><a href="#多端开发系统体验" class="table-of-contents__link">多端开发系统体验</a></li><li><a href="#可扩展性" class="table-of-contents__link">可扩展性</a></li><li><a href="#接入方便" class="table-of-contents__link">接入方便</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer_mib0 section_3Kiu"><div class="footer__inner_z0Le section--inner_2xOo"><div class="footer__column_3Npq footer__column--left_1EuR"><img alt="FshareIM logo" class="footer__logo_29Wo" src="/img/footer/fsharechat.svg" title="飞享IM 做技术自主可控的即时通讯IM"><p class="footer__tagline_2F15">FshareIM是一个技术自主可控即时IM通讯系统,适于私有化部署</p><a class="footer__github_8UHO button_Ni2_ button--icon_3YKU button--secondary_1x2U button--xsmall_3jz_" href="https://github.com/fsharechat" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_3Npq footer__column--right_1XPX"><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">飞享IM</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/docs/introduction/">文档</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/orgs/fsharechat/projects/1" rel="noopener noreferrer" target="_blank">路线图</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">社区</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/community/">公众号</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/community/">QQ群</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://weibo.com/comsince" rel="noopener noreferrer" target="_blank">微博</a></li></ul></div><div class="footer__links_3WB8"><ul class="footer__items_3gGI"><li class="footer__title_1y7h">更多</li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="/blog/">博客</a></li><li class="footer__item_1JzF"><a class="footer__link_2PDg" href="https://github.com/fsharechat" rel="noopener noreferrer" target="_blank">GitHub</a></li></ul></div></div></div><div class="footer__bottom_2RpL"><p class="footer__copyright_1o2i">Copyright © 2020 Fsharechat</p></div></footer></div>
<script src="/styles.83dda306.js" defer="defer"></script>
<script src="/main.5dcd2c6c.js" defer="defer"></script>
<script src="/common.b5dd947b.js" defer="defer"></script>
<script src="/1be78505.aae07415.js" defer="defer"></script>
<script src="/935f2afb.057038a3.js" defer="defer"></script>
<script src="/17896441.f99ec223.js" defer="defer"></script>
<script src="/00f45bf5.fba0ed59.js" defer="defer"></script>
</body>
</html>